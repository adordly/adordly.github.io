<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>SpringBoot自动配置(二) | 咳咳</title><meta name="keywords" content="Springboot"><meta name="author" content="咳咳"><meta name="copyright" content="咳咳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot自动配置(二)1. 概述 友情提示：因为本文是分享 Spring Boot 自动配置的原理，所以需要胖友有使用过 Spring Boot 的经验。如果还没使用过的胖友，不用慌，先跳转到《芋道 Spring Boot SpringMVC 入门》文章，将前两节阅读完，感受下 Spring Boot 的魅力。  Spring Boot 自动配置，顾名思义，是希望能够自动配置，将我们从"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot自动配置(二)"><meta property="og:url" content="https://adordly.github.io/2022/01/22/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE(%E4%BA%8C)/index.html"><meta property="og:site_name" content="咳咳"><meta property="og:description" content="SpringBoot自动配置(二)1. 概述 友情提示：因为本文是分享 Spring Boot 自动配置的原理，所以需要胖友有使用过 Spring Boot 的经验。如果还没使用过的胖友，不用慌，先跳转到《芋道 Spring Boot SpringMVC 入门》文章，将前两节阅读完，感受下 Spring Boot 的魅力。  Spring Boot 自动配置，顾名思义，是希望能够自动配置，将我们从"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://adordly.github.io/img/text/Spring1.jpeg"><meta property="article:published_time" content="2022-01-21T17:26:47.000Z"><meta property="article:modified_time" content="2022-03-15T16:22:41.096Z"><meta property="article:author" content="咳咳"><meta property="article:tag" content="Springboot"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://adordly.github.io/img/text/Spring1.jpeg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://adordly.github.io/2022/01/22/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE(%E4%BA%8C)/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"SpringBoot自动配置(二)",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-03-16 00:22:41"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0!==o){const a=new Date;o=864e5*o,t={value:t,expiry:a.getTime()+o};localStorage.setItem(e,JSON.stringify(t))}},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);const o=new Date;if(!(o.getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=a=>new Promise((t,e)=>{const o=document.createElement("script");o.src=a,o.async=!0,o.onerror=e,o.onload=o.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(o.onload=o.onreadystatechange=null,t())},document.head.appendChild(o)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/social_img.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/text/Spring1.jpeg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">咳咳</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot自动配置(二)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-21T17:26:47.000Z" title="发表于 2022-01-22 01:26:47">2022-01-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-15T16:22:41.096Z" title="更新于 2022-03-16 00:22:41">2022-03-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Springboot/">Springboot</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="SpringBoot自动配置(二)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot自动配置-二"><a href="#SpringBoot自动配置-二" class="headerlink" title="SpringBoot自动配置(二)"></a>SpringBoot自动配置(二)</h1><h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><blockquote><p>友情提示：因为本文是分享 Spring Boot 自动配置的原理，所以需要胖友有使用过 Spring Boot 的经验。如果还没使用过的胖友，不用慌，先跳转到<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/SpringMVC/?self">《芋道 Spring Boot SpringMVC 入门》</a>文章，将前两节阅读完，感受下 Spring Boot 的魅力。</p></blockquote><p>Spring Boot 自动配置，顾名思义，是希望能够自动配置，将我们从配置的苦海中解脱出来。那么既然要自动配置，它需要解三个问题：</p><ul><li>满足什么样的<strong>条件</strong>？</li><li>创建<strong>哪些</strong> Bean？</li><li>创建的 Bean 的<strong>属性</strong>？</li></ul><p>我们来举个示例，对照下这三个问题。在我们引入 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web"><code>spring-boot-starter-web</code></a> 依赖，会创建一个 8080 端口的内嵌 Tomcat，同时可以通过 <code>application.yaml</code> 配置文件中的 <code>server.port</code> 配置项自定义端口。那么这三个问题的答案如下：</p><blockquote><p>友情提示：为了更易懂，这里的答案暂时是表象的，不绝对精准。</p></blockquote><ul><li>满足什么样的<strong>条件</strong>？因为我们引入了 <code>spring-boot-starter-web</code> 依赖。</li><li>创建<strong>哪些</strong> Bean？创建了一个内嵌的 Tomcat Bean，并进行启动。</li><li>创建的 Bean 的<strong>属性</strong>？通过 <code>application.yaml</code> 配置文件的 <code>server.port</code> 配置项，定义 Tomcat Bean 的启动端口属性，并且默认值为 8080。</li></ul><p>壮着胆子，我们来看看 Spring Boot 提供的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/EmbeddedWebServerFactoryCustomizerAutoConfiguration.java">EmbeddedWebServerFactoryCustomizerAutoConfiguration</a> 类，负责创建内嵌的 Tomcat、Jetty 等等 Web 服务器的配置类。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// &lt;1.1&gt;</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">// &lt;2.1&gt;</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span> <span class="comment">// &lt;3.1&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span>  <span class="title class_">EmbeddedWebServerFactoryCustomizerAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Nested configuration if Tomcat is being used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Configuration</span> <span class="comment">// &lt;1.2&gt;</span></span><br><span class="line">	<span class="meta">@ConditionalOnClass(&#123; Tomcat.class, UpgradeProtocol.class &#125;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TomcatWebServerFactoryCustomizerConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="keyword">public</span> TomcatWebServerFactoryCustomizer <span class="title function_">tomcatWebServerFactoryCustomizer</span><span class="params">(</span></span><br><span class="line"><span class="params">				Environment environment, ServerProperties serverProperties)</span> &#123;</span><br><span class="line">			<span class="comment">// &lt;3.2&gt;</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServerFactoryCustomizer</span>(environment, serverProperties);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Configuration</span> <span class="comment">// &lt;1.3&gt;</span></span><br><span class="line">	<span class="meta">@ConditionalOnClass(&#123; Server.class, Loader.class, WebAppContext.class &#125;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JettyWebServerFactoryCustomizerConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="keyword">public</span> JettyWebServerFactoryCustomizer <span class="title function_">jettyWebServerFactoryCustomizer</span><span class="params">(</span></span><br><span class="line"><span class="params">				Environment environment, ServerProperties serverProperties)</span> &#123;</span><br><span class="line">			 <span class="comment">// &lt;3.3&gt;</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyWebServerFactoryCustomizer</span>(environment, serverProperties);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// ... 省略 UndertowWebServerFactoryCustomizerConfiguration 代码</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Nested configuration if Netty is being used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// ... 省略 NettyWebServerFactoryCustomizerConfiguration 代码</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在开始看代码之前，我们先来简单科普下 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-javaconfig/docs/1.0.0.M4/reference/html/">Spring JavaConfig</a> 的小知识。在 Spring3.0 开始，Spring 提供了 JavaConfig 的方式，允许我们使用 Java 代码的方式，进行 Spring Bean 的创建。示例代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">object</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Obejct</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过在<strong>类</strong>上添加 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-javaconfig/docs/1.0.0.M4/reference/html/ch02.html#d0e270"><code>@Configuration</code></a> 注解，声明这是一个 Spring 配置类。</li><li>通过在<strong>方法</strong>上添加 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-javaconfig/docs/1.0.0.M4/reference/html/ch02s02.html"><code>@Bean</code></a> 注解，声明该方法创建一个 Spring Bean。</li></ul><p>OK，现在我们在回过头看看 EmbeddedWebServerFactoryCustomizerAutoConfiguration 的代码，我们分成三块内容来讲，刚好解决我们上面说的三个问题：</p><ul><li>① 配置类</li><li>② 条件注解</li><li>③ 配置属性</li></ul><p><strong>① 配置类</strong></p><p><code>&lt;1.1&gt;</code> 处，在类上添加了 <code>@Configuration</code> 注解，声明这是一个<strong>配置类</strong>。因为它的目的是自动配置，所以类名以 AutoConfiguration 作为后缀。</p><p><code>&lt;1.2&gt;</code>、<code>&lt;1.3&gt;</code> 处，分别是用于初始化 Tomcat、Jetty 相关 Bean 的配置类。</p><ul><li>TomcatWebServerFactoryCustomizerConfiguration 配置类，负责创建 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/TomcatWebServerFactoryCustomizer.java">TomcatWebServerFactoryCustomizer</a> Bean，从而初始化内嵌的 Tomcat 并进行启动。</li><li>JettyWebServerFactoryCustomizer 配置类，负责创建 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/JettyWebServerFactoryCustomizer.java">JettyWebServerFactoryCustomizer</a> Bean，从而初始化内嵌的 Jetty 并进行启动。</li></ul><p><strong>如此，我们可以得到结论一，通过 <code>@Configuration</code> 注解的配置类，可以解决“创建哪些 Bean”的问题。</strong></p><p>实际上，Spring Boot 的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure">spring-boot-autoconfigure</a> 项目，提供了大量框架的自动配置类，稍后我们在<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/autoconfigure/?github#">「2. 自动配置类」</a>小节详细展开。</p><p><strong>② 条件注解</strong></p><p><code>&lt;2&gt;</code> 处，在类上添加了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/condition/ConditionalOnWebApplication.java"><code>@ConditionalOnWebApplication</code></a> <strong>条件注解</strong>，表示当前配置类需要在当前项目是 Web 项目的条件下，才能生效。在 Spring Boot 项目中，会将项目类型分成 Web 项目（使用 SpringMVC 或者 WebFlux）和非 Web 项目。这样我们就很容易理解，为什么 EmbeddedWebServerFactoryCustomizerAutoConfiguration 配置类会要求在项目类型是 Web 项目，只有 Web 项目才有必要创建内嵌的 Web 服务器呀。</p><p><code>&lt;2.1&gt;</code>、<code>&lt;2.2&gt;</code> 处，在类上添加了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/condition/ConditionalOnClass.java"><code>@ConditionalOnClass</code></a> <strong>条件注解</strong>，表示当前配置类需要在当前项目有指定类的条件下，才能生效。</p><ul><li>TomcatWebServerFactoryCustomizerConfiguration 配置类，需要有 <a target="_blank" rel="noopener" href="https://mvnrepository.com/search?q=tomcat-embed-core"><code>tomcat-embed-core</code></a> 依赖提供的 Tomcat、UpgradeProtocol 依赖类，才能创建内嵌的 Tomcat 服务器。</li><li>JettyWebServerFactoryCustomizer 配置类，需要有 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.eclipse.jetty/jetty-server"><code>jetty-server</code></a> 依赖提供的 Server、Loader、WebAppContext 类，才能创建内嵌的 Jetty 服务器。</li></ul><p><strong>如此，我们可以得到结论二，通过条件注解，可以解决“满足什么样的条件？”的问题。</strong></p><p>实际上，Spring Boot 的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/condition"><code>condition</code></a> 包下，提供了大量的条件注解，稍后我们在<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/autoconfigure/?github#">「2. 条件注解」</a>小节详细展开。</p><p><strong>③ 配置属性</strong></p><p><code>&lt;3.1&gt;</code> 处，使用 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/properties/EnableConfigurationProperties.java"><code>@EnableConfigurationProperties</code></a> 注解，让 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a> <strong>配置属性类</strong>生效。在 Spring Boot 定义了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/properties/ConfigurationProperties.java"><code>@ConfigurationProperties</code></a> 注解，用于声明配置属性类，将指定前缀的配置项批量注入到该类中。例如 ServerProperties 代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;server&quot;, ignoreUnknownFields = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerProperties</span></span><br><span class="line">		<span class="keyword">implements</span> <span class="title class_">EmbeddedServletContainerCustomizer</span>, EnvironmentAware, Ordered &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Server HTTP port.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer port;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Context path of the application.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String contextPath;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ... 省略其它属性</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过 <code>@ConfigurationProperties</code> 注解，声明将 <code>server</code> 前缀的配置项，设置到 ServerProperties 配置属性类中。</li></ul><p><code>&lt;3.2&gt;</code>、<code>&lt;3.3&gt;</code> 处，在创建 TomcatWebServerFactoryCustomizer 和 JettyWebServerFactoryCustomizer 对象时，都会将 ServerProperties 传入其中，作为后续创建的 Web 服务器的配置。也就是说，我们通过修改在配置文件的配置项，就可以自定义 Web 服务器的配置。</p><p><strong>如此，我们可以得到结论三，通过配置属性，可以解决“创建的 Bean 的属性？”的问题。</strong></p><hr><p>🐶 至此，我们已经比较清晰的理解 Spring Boot 是怎么解决我们上面提出的三个问题，但是这样还是无法实现自动配置。例如说，我们引入的 <code>spring-boot-starter-web</code> 等依赖，Spring Boot 是怎么知道要扫码哪些配置类的。下面，继续我们的旅途，继续抽丝剥茧。</p><h1 id="2-自动配置类"><a href="#2-自动配置类" class="headerlink" title="2. 自动配置类"></a>2. 自动配置类</h1><p>在 Spring Boot 的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure">spring-boot-autoconfigure</a> 项目，提供了大量框架的自动配置，如下图所示：![<code>spring-boot-autoconfigure</code>](第二章-Spring Boot自动配置原理.assets&#x2F;01.png)</p><p>在我们通过 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/SpringApplication.java#L1218-L1227"><code>SpringApplication#run(Class primarySource, String... args)</code></a> 方法，启动 Spring Boot 应用的时候，有个非常重要的组件 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/io/support/SpringFactoriesLoader.java">SpringFactoriesLoader</a> 类，会读取 <code>META-INF</code> 目录下的 <code>spring.factories</code> 文件，获得<strong>每个框架定义的需要自动配置的配置类</strong>。</p><p>我们以 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure">spring-boot-autoconfigure</a> 项目的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories">Spring Boot <code>spring.factories</code></a> 文件来举个例子，如下图所示：![<code>spring.factories</code>](第二章-Spring Boot自动配置原理.assets&#x2F;02.png)</p><p>如此，原先 <code>@Configuration</code> 注解的配置类，就<strong>升级</strong>成类自动配置类。这样，Spring Boot 在获取到需要自动配置的配置类后，就可以自动创建相应的 Bean，完成自动配置的功能。</p><blockquote><p>旁白君：这里其实还有一个非常有意思的话题，作为拓展知识，胖友可以后续去看看。实际上，我们可以把 <code>spring.factories</code> 理解成 Spring Boot 自己的 SPI 机制。感兴趣的胖友，可以看看如下的文章：</p><ul><li><a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/SPI-mechanism-in-Spring-Boot/?self">《Spring Boot 的 SPI 机制》</a></li><li><a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/xuma/spi/?self">《Java 的 SPI 机制》</a></li><li><a target="_blank" rel="noopener" href="http://dubbo.apache.org/zh-cn/docs/dev/SPI.html">《Dubbo 的 SPI 机制》</a></li></ul><p>实际上，自动配置只是 Spring Boot 基于 <code>spring.factories</code> 的一个拓展点 EnableAutoConfiguration。我们从上图中，还可以看到如下的拓展点：</p><ul><li>ApplicationContextInitializer</li><li>ApplicationListener</li><li>AutoConfigurationImportListener</li><li>AutoConfigurationImportFilter</li><li>FailureAnalyzer</li><li>TemplateAvailabilityProvider</li></ul></blockquote><p>因为 spring-boot-autoconfigure 项目提供的是它选择的主流框架的自动配置，所以其它框架需要自己实现。例如说，Dubbo 通过 <a target="_blank" rel="noopener" href="https://github.com/apache/dubbo-spring-boot-project">dubbo-spring-boot-project</a> 项目，提供 Dubbo 的自动配置。如下图所示：![Dubbo <code>spring.factories</code>](第二章-Spring Boot自动配置原理.assets&#x2F;03.png)</p><h1 id="3-条件注解"><a href="#3-条件注解" class="headerlink" title="3. 条件注解"></a>3. 条件注解</h1><p>条件注解并不是 Spring Boot 所独有，而是在 Spring3.1 版本时，为了满足不同环境注册不同的 Bean ，引入了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/context/annotation/Profile.java"><code>@Profile</code></a> 注解。示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class DataSourceConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Profile(&quot;DEV&quot;)</span><br><span class="line">    public DataSource devDataSource() &#123;</span><br><span class="line">        // ... 单机 MySQL</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Profile(&quot;PROD&quot;)</span><br><span class="line">    public DataSource prodDataSource() &#123;</span><br><span class="line">        // ... 集群 MySQL</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在测试环境下，我们注册单机 MySQL 的 DataSource Bean。</li><li>在生产环境下，我们注册集群 MySQL 的 DataSource Bean。</li></ul><p>在 Spring4 版本时，提供了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/context/annotation/Conditional.java"><code>@Conditional</code></a> 注解，用于声明在配置类或者创建 Bean 的方法上，表示需要满足指定条件才能生效。示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class TestConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Conditional(XXXCondition.class)</span><br><span class="line">    public Object xxxObject() &#123;</span><br><span class="line">        return new Object();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>其中，XXXCondition 需要我们自己实现 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/context/annotation/Condition.java">Condition</a> 接口，提供具体的条件实现。</li></ul><p>显然，Spring4 提交的 <code>@Conditional</code> 注解非常不方便，需要我们自己去拓展。因此，Spring Boot 进一步增强，提供了常用的条件注解：</p><ul><li><code>@ConditionalOnBean</code>：当容器里有指定 Bean 的条件下</li><li><code>@ConditionalOnMissingBean</code>：当容器里没有指定 Bean 的情况下</li><li><code>@ConditionalOnSingleCandidate</code>：当指定 Bean 在容器中只有一个，或者虽然有多个但是指定首选 Bean</li><li><code>@ConditionalOnClass</code>：当类路径下有指定类的条件下</li><li><code>@ConditionalOnMissingClass</code>：当类路径下没有指定类的条件下</li><li><code>@ConditionalOnProperty</code>：指定的属性是否有指定的值</li><li><code>@ConditionalOnResource</code>：类路径是否有指定的值</li><li><code>@ConditionalOnExpression</code>：基于 SpEL 表达式作为判断条件</li><li><code>@ConditionalOnJava</code>：基于 Java 版本作为判断条件</li><li><code>@ConditionalOnJndi</code>：在 JNDI 存在的条件下差在指定的位置</li><li><code>@ConditionalOnNotWebApplication</code>：当前项目不是 Web 项目的条件下</li><li><code>@ConditionalOnWebApplication</code>：当前项目是 Web项 目的条件下</li></ul><h1 id="4-配置属性"><a href="#4-配置属性" class="headerlink" title="4. 配置属性"></a>4. 配置属性</h1><p>Spring Boot 约定读取 <code>application.yaml</code>、<code>application.properties</code> 等配置文件，从而实现创建 Bean 的自定义属性配置，甚至可以搭配 <code>@ConditionalOnProperty</code> 注解来取消 Bean 的创建。</p><p>咳咳咳，貌似这个小节没有太多可以分享的内容，更多胖友可以阅读<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/config-file/?self">《芋道 Spring Boot 配置文件入门》</a>文章。</p><h1 id="5-内置-Starter"><a href="#5-内置-Starter" class="headerlink" title="5. 内置 Starter"></a>5. 内置 Starter</h1><p>我们在使用 Spring Boot 时，并不会直接引入 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-autoconfigure"><code>spring-boot-autoconfigure</code></a> 依赖，而是使用 Spring Boot 内置提供的 Starter 依赖。例如说，我们想要使用 SpringMVC 时，引入的是 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web"><code>spring-boot-starter-web</code></a> 依赖。这是为什么呢？</p><p>因为 Spring Boot 提供的自动配置类，基本都有 <code>@ConditionalOnClass</code> 条件注解，判断我们项目中存在指定的类，才会创建对应的 Bean。而拥有指定类的前提，一般是需要我们引入对应框架的依赖。</p><p>因此，在我们引入 <code>spring-boot-starter-web</code> 依赖时，它会帮我们自动引入相关依赖，从而保证自动配置类能够生效，创建对应的 Bean。如下图所示：![<code>spring-boot-starter-web</code>](第二章-Spring Boot自动配置原理.assets&#x2F;11-20200907070313426.png)</p><p>Spring Boot 内置了非常多的 Starter，方便我们引入不同框架，并实现自动配置。如下图所示：![Spring Boot Starter](第二章-Spring Boot自动配置原理.assets&#x2F;12-20200907070313269.png)</p><h1 id="6-自定义-Starter"><a href="#6-自定义-Starter" class="headerlink" title="6. 自定义 Starter"></a>6. 自定义 Starter</h1><p>在一些场景下，我们需要自己实现自定义 Starter 来达到自动配置的目的。例如说：</p><ul><li>三方框架并没有提供 Starter，比如说 <a target="_blank" rel="noopener" href="https://github.com/swagger-api">Swagger</a>、<a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job">XXL-JOB</a> 等。</li><li>Spring Boot 内置的 Starter 无法满足自己的需求，比如说 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc"><code>spring-boot-starter-jdbc</code></a> 不提供多数据源的配置。</li><li>随着项目越来越大，想要提供适合自己团队的 Starter 来方便配置项目，比如说永辉彩食鲜 <a target="_blank" rel="noopener" href="https://gitee.com/yhcsx/csx-bsf-all">csx-bsf-all</a> 项目。</li></ul><p>下面，我们一起来实现一个自定义 Starter，实现一个 Java 内置 <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/jre/api/net/httpserver/spec/com/sun/net/httpserver/HttpServer.html">HttpServer</a> 服务器的自动化配置。最终项目如下图所示：![最终项目](第二章-Spring Boot自动配置原理.assets&#x2F;21.png)</p><p>在开始示例之前，我们要了解下 Spring Boot Starter 的<strong>命名规则</strong>，显得我们更加专业（装逼）。命名规则如下：</p><table><thead><tr><th align="left">场景</th><th align="left">命名规则</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><strong>Spring Boot 内置</strong> Starter</td><td align="left"><code>spring-boot-starter-&#123;框架&#125;</code></td><td align="left"><code>spring-boot-starter-web</code></td></tr><tr><td align="left">框架 <strong>自定义</strong> Starter</td><td align="left"><code>&#123;框架&#125;-spring-boot-starter</code></td><td align="left"><a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter"><code>mybatis-spring-boot-starter</code></a></td></tr><tr><td align="left">公司 <strong>自定义</strong> Starter</td><td align="left"><code>&#123;公司&#125;-spring-boot-starter-&#123;框架&#125;</code></td><td align="left">暂无，艿艿自己的想法哈</td></tr></tbody></table><h2 id="6-1-yunai-server-spring-boot-starter-项目"><a href="#6-1-yunai-server-spring-boot-starter-项目" class="headerlink" title="6.1 yunai-server-spring-boot-starter 项目"></a>6.1 yunai-server-spring-boot-starter 项目</h2><p>创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-47/yunai-server-spring-boot-starter">yunai-server-spring-boot-starter</a> 项目，实现一个 Java 内置 HttpServer 服务器的自动化配置。考虑到示例比较简单，我们就不像 Spring Boot 拆分成 <code>spring-boot-autoconfigure</code> 和 <code>spring-boot-starter-&#123;框架&#125;</code> 两个项目。</p><h3 id="6-1-1-引入依赖"><a href="#6-1-1-引入依赖" class="headerlink" title="6.1.1 引入依赖"></a>6.1.1 引入依赖</h3><p>在 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/pom.xml"><code>pom.xml</code></a> 文件中，引入相关依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lab-47<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yunai-server-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入 Spring Boot Starter 基础库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-1-2-YunaiServerProperties"><a href="#6-1-2-YunaiServerProperties" class="headerlink" title="6.1.2 YunaiServerProperties"></a>6.1.2 YunaiServerProperties</h3><p>在 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/src/main/java/cn/iocoder/springboot/lab47/yunaiserver/autoconfigure/"><code>cn.iocoder.springboot.lab47.yunaiserver.autoconfigure</code></a> 包下，创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/src/main/java/cn/iocoder/springboot/lab47/yunaiserver/autoconfigure/YunaiServerProperties.java">YunaiServerProperties</a> 配置属性类，读取 <code>yunai.server</code> 前缀的配置项。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;yunai.server&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YunaiServerProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认端口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DEFAULT_PORT</span> <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 端口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">port</span> <span class="operator">=</span> DEFAULT_PORT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">getDefaultPort</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DEFAULT_PORT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPort</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> YunaiServerProperties <span class="title function_">setPort</span><span class="params">(Integer port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-1-3-YunaiServerAutoConfiguration"><a href="#6-1-3-YunaiServerAutoConfiguration" class="headerlink" title="6.1.3 YunaiServerAutoConfiguration"></a>6.1.3 YunaiServerAutoConfiguration</h3><p>在 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/src/main/java/cn/iocoder/springboot/lab47/yunaiserver/autoconfigure/"><code>cn.iocoder.springboot.lab47.yunaiserver.autoconfigure</code></a> 包下，创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/src/main/java/cn/iocoder/springboot/lab47/yunaiserver/autoconfigure/YunaiServerAutoConfiguration.java">YunaiServerAutoConfiguration</a> 自动配置类，在项目中存在 <code>com.sun.net.httpserver.HttpServer</code> 类时，创建 HttpServer Bean，并启动该服务器。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 声明配置类</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(YunaiServerProperties.class)</span> <span class="comment">// 使 YunaiServerProperties 配置属性类生效</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YunaiServerAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(YunaiServerAutoConfiguration.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 声明创建 Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(HttpServer.class)</span> <span class="comment">// 需要项目中存在 com.sun.net.httpserver.HttpServer 类。该类为 JDK 自带，所以一定成立。</span></span><br><span class="line">    <span class="keyword">public</span> HttpServer <span class="title function_">httpServer</span><span class="params">(YunaiServerProperties serverProperties)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建 HttpServer 对象，并启动</span></span><br><span class="line">        <span class="type">HttpServer</span> <span class="variable">server</span> <span class="operator">=</span> HttpServer.create(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(serverProperties.getPort()), <span class="number">0</span>);</span><br><span class="line">        server.start();</span><br><span class="line">        logger.info(<span class="string">&quot;[httpServer][启动服务器成功，端口为:&#123;&#125;]&quot;</span>, serverProperties.getPort());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回</span></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>代码比较简单，胖友看看艿艿在代码上添加的注释哟。</li></ul><h3 id="6-1-4-spring-factories"><a href="#6-1-4-spring-factories" class="headerlink" title="6.1.4 spring.factories"></a>6.1.4 spring.factories</h3><p>在 <code>resources</code> 目录下创建，创建 <code>META-INF</code> 目录，然后在该目录下创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/yunai-server-spring-boot-starter/src/main/resources/META-INF/spring.factories"><code>spring.factories</code></a> 文件，添加自动化配置类为 YunaiServerAutoConfiguration。内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">cn.iocoder.springboot.lab47.yunaiserver.autoconfigure.YunaiServerAutoConfiguration</span><br></pre></td></tr></table></figure><p>至此，我们已经完成了一个自定义的 Starter。下面，我们在<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/autoconfigure/?github#">「6.2 lab-47-demo 项目」</a>中引入，然后进行测试。</p><h2 id="6-2-lab-47-demo-项目"><a href="#6-2-lab-47-demo-项目" class="headerlink" title="6.2 lab-47-demo 项目"></a>6.2 lab-47-demo 项目</h2><p>创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/lab-47-demo/pom.xml">lab-47-demo</a> 项目，引入我们自定义 Starter。</p><h3 id="6-2-1-引入依赖"><a href="#6-2-1-引入依赖" class="headerlink" title="6.2.1 引入依赖"></a>6.2.1 引入依赖</h3><p>在 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/lab-47-demo/pom.xml"><code>pom.xml</code></a> 文件中，引入相关依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lab-47<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lab-47-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自定义 Starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yunai-server-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-2-2-配置文件"><a href="#6-2-2-配置文件" class="headerlink" title="6.2.2 配置文件"></a>6.2.2 配置文件</h3><p>在 <code>resource</code> 目录下，创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/lab-47-demo/src/main/resources/application.yaml"><code>application.yaml</code></a> 配置文件，设置 <code>yunai.server.port</code> 配置项来自定义 HttpServer 端口。配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">yunai:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8888</span> <span class="comment"># 自定义 HttpServer 端口</span></span><br></pre></td></tr></table></figure><h3 id="6-2-3-DemoApplication"><a href="#6-2-3-DemoApplication" class="headerlink" title="6.2.3 DemoApplication"></a>6.2.3 DemoApplication</h3><p>创建 <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-47/lab-47-demo/src/main/java/cn/iocoder/springboot/lab47/demo/DemoApplication.java"><code>DemoApplication.java</code></a> 类，配置 <code>@SpringBootApplication</code> 注解即可。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-4-简单测试"><a href="#6-2-4-简单测试" class="headerlink" title="6.2.4 简单测试"></a>6.2.4 简单测试</h3><p>执行 <code>DemoApplication#main(String[] args)</code> 方法，启动 Spring Boot 应用。打印日志如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-02-02 13:03:12.156  INFO 76469 --- [           main] c.i.s.lab47.demo.DemoApplication         : Starting DemoApplication on MacBook-Pro-8 with PID 76469 (/Users/yunai/Java/SpringBoot-Labs/lab-47/lab-47-demo/target/classes started by yunai <span class="keyword">in</span> /Users/yunai/Java/SpringBoot-Labs)</span><br><span class="line">2020-02-02 13:03:12.158  INFO 76469 --- [           main] c.i.s.lab47.demo.DemoApplication         : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2020-02-02 13:03:12.873  INFO 76469 --- [           main] c.i.s.l.y.a.YunaiServerAutoConfiguration : [httpServer][启动服务器成功，端口为:8888]</span><br><span class="line">2020-02-02 13:03:12.927  INFO 76469 --- [           main] c.i.s.lab47.demo.DemoApplication         : Started DemoApplication <span class="keyword">in</span> 1.053 seconds (JVM running <span class="keyword">for</span> 1.47)</span><br></pre></td></tr></table></figure><ul><li>YunaiServerAutoConfiguration 成功自动配置 HttpServer Bean，并启动该服务器在 8888 端口。</li></ul><p>此时，我们使用浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888/</a> 地址，返回结果为 404 Not Found。因为我们没有给 HttpServer 相应的 Handler。</p><h1 id="666-彩蛋"><a href="#666-彩蛋" class="headerlink" title="666. 彩蛋"></a>666. 彩蛋</h1><p>至此，我们已经完成了 Spring Boot 自动配置的原理学习。如果有不理解的地方，请给艿艿留言哟。</p><p>在理解 Spring Boot 自动配置的原理的过程中，我们会发现，无论是配置类，还是条件注解也好，实际 Spring 原本都已经进行提供。甚至说，SpringFactoriesLoader 竟然也是 Spring 提供的。所以，Spring Boot 是在 Spring 的基础之上，实现了一套 Boot 启动机制。</p><p>Spring 的核心之一是 IOC，负责管理 Bean 的生命周期。而 Spring Boot 则是对 Java 应用的生命周期的管理。</p><ul><li>在 Spring 的年代，我们都是使用 Tomcat 外部容器来实现 Java 应用的运行，Spring 只是其中的一个组件。</li><li>在 Spring Boot 的年代，我们使用 Spring Boot 来管理 Java 应用的运行，内嵌的 Tomcat 反而成为其中的一个组件。</li></ul><p>😈 另外，在推荐如下的文章，方便胖友进一步对 Spring Boot 有深入理解：</p><ul><li><a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/Give-you-a-list-of-Spring-Boot-knowledge/?self">《给你一份 Spring Boot 知识清单》</a></li><li><a target="_blank" rel="noopener" href="http://www.iocoder.ccn/Fight/Details-the-Spring-Boot-automatic-configuration-mechanism/?self">《详解 Spring Boot 自动配置机制》</a></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">芋道源码</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/autoconfigure/">http://www.iocoder.cn/Spring-Boot/autoconfigure/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">此文章版权归芋道源码所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Springboot/">Springboot</a></div><div class="post_share"><div class="social-share" data-image="/img/text/Spring1.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/24/SpringBoot%E6%95%B4%E5%90%88%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E5%BA%93/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/Spring1.jpeg" onerror='onerror=null,src="/img/404.jpeg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Springboot整合相关数据库</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/22/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE(%E4%B8%80)/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/Spring1.jpeg" onerror='onerror=null,src="/img/404.jpeg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot自动配置(一)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/02/24/SpringBoot%E6%95%B4%E5%90%88%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Springboot整合相关数据库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/Spring1.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-24</div><div class="title">Springboot整合相关数据库</div></div></a></div><div><a href="/2022/01/22/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE(%E4%B8%80)/" title="SpringBoot自动配置(一)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/Spring1.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-22</div><div class="title">SpringBoot自动配置(一)</div></div></a></div><div><a href="/2022/02/28/Springboot%E5%88%A9%E7%94%A8JSCH%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" title="Springboot利用JSCH实现远程服务器的文件传输"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/spring.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-28</div><div class="title">Springboot利用JSCH实现远程服务器的文件传输</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/social_img.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">咳咳</div><div class="author-info__description">没有选择会是唯一的路</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a id="card-info-btn" href="https://adordly.github.io/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一名拖更的懒博主</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-%E4%BA%8C"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot自动配置(二)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">1. 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">2. 自动配置类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.</span> <span class="toc-text">3. 条件注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">4. 配置属性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%86%85%E7%BD%AE-Starter"><span class="toc-number">6.</span> <span class="toc-text">5. 内置 Starter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E8%87%AA%E5%AE%9A%E4%B9%89-Starter"><span class="toc-number">7.</span> <span class="toc-text">6. 自定义 Starter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-yunai-server-spring-boot-starter-%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.1.</span> <span class="toc-text">6.1 yunai-server-spring-boot-starter 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">7.1.1.</span> <span class="toc-text">6.1.1 引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-YunaiServerProperties"><span class="toc-number">7.1.2.</span> <span class="toc-text">6.1.2 YunaiServerProperties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-YunaiServerAutoConfiguration"><span class="toc-number">7.1.3.</span> <span class="toc-text">6.1.3 YunaiServerAutoConfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-4-spring-factories"><span class="toc-number">7.1.4.</span> <span class="toc-text">6.1.4 spring.factories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-lab-47-demo-%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.2.</span> <span class="toc-text">6.2 lab-47-demo 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.1.</span> <span class="toc-text">6.2.1 引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.2.</span> <span class="toc-text">6.2.2 配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-DemoApplication"><span class="toc-number">7.2.3.</span> <span class="toc-text">6.2.3 DemoApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.4.</span> <span class="toc-text">6.2.4 简单测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#666-%E5%BD%A9%E8%9B%8B"><span class="toc-number">8.</span> <span class="toc-text">666. 彩蛋</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/02/28/Springboot%E5%88%A9%E7%94%A8JSCH%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" title="Springboot利用JSCH实现远程服务器的文件传输"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/spring.jpeg" onerror='this.onerror=null,this.src="/img/404.jpeg"' alt="Springboot利用JSCH实现远程服务器的文件传输"></a><div class="content"><a class="title" href="/2022/02/28/Springboot%E5%88%A9%E7%94%A8JSCH%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" title="Springboot利用JSCH实现远程服务器的文件传输">Springboot利用JSCH实现远程服务器的文件传输</a><time datetime="2022-02-27T17:26:47.000Z" title="发表于 2022-02-28 01:26:47">2022-02-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/26/Maven/" title="Maven"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/maven.jpg" onerror='this.onerror=null,this.src="/img/404.jpeg"' alt="Maven"></a><div class="content"><a class="title" href="/2022/02/26/Maven/" title="Maven">Maven</a><time datetime="2022-02-26T14:46:47.000Z" title="发表于 2022-02-26 22:46:47">2022-02-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/26/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/" title="Vue组件开发"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/vue.jpeg" onerror='this.onerror=null,this.src="/img/404.jpeg"' alt="Vue组件开发"></a><div class="content"><a class="title" href="/2022/02/26/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/" title="Vue组件开发">Vue组件开发</a><time datetime="2022-02-26T08:14:47.000Z" title="发表于 2022-02-26 16:14:47">2022-02-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/25/deepLearningSemanticSegmentation/" title="深度学习语义分割理论与实战指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/deeplearning.png" onerror='this.onerror=null,this.src="/img/404.jpeg"' alt="深度学习语义分割理论与实战指南"></a><div class="content"><a class="title" href="/2022/02/25/deepLearningSemanticSegmentation/" title="深度学习语义分割理论与实战指南">深度学习语义分割理论与实战指南</a><time datetime="2022-02-25T03:46:47.000Z" title="发表于 2022-02-25 11:46:47">2022-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/24/SpringBoot%E6%95%B4%E5%90%88%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Springboot整合相关数据库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/text/Spring1.jpeg" onerror='this.onerror=null,this.src="/img/404.jpeg"' alt="Springboot整合相关数据库"></a><div class="content"><a class="title" href="/2022/02/24/SpringBoot%E6%95%B4%E5%90%88%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Springboot整合相关数据库">Springboot整合相关数据库</a><time datetime="2022-02-23T17:26:47.000Z" title="发表于 2022-02-24 01:26:47">2022-02-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/text/Spring1.jpeg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 咳咳</div><div class="footer_custom_text">Hi, welcome to my blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>function loadValine(){function n(){new Valine(Object.assign({el:"#vcomment",appId:"GsGNLORFmjCB9yFfADJIBAR4-gzGzoHsz",appKey:"DeLHVpVyM3s1NHtFDhAuQeMY",avatar:"monsterid",serverURLs:"",emojiMaps:"",path:window.location.pathname,visitor:!1},null))}"function"==typeof Valine?n():getScript("https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js").then(n)}function loadOtherComment(){loadValine()}btf.loadComment(document.getElementById("vcomment"),loadValine)</script></div><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>